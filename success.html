<!DOCTYPE HTML>

 <html>

    <head>

    	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

        <meta charset="utf-8">

        <!-- Description, Keywords and Author -->

        <meta name="description" content="">

        <meta name="author" content="">

        

        <title>Shree Balaji Spareparts</title>

		<link rel="shortcut icon" href="images/logo.png" type="image/x-icon">



        <!-- style -->

        <link href="css/style.css" rel="stylesheet" type="text/css">

        <!-- style -->

        <!-- bootstrap -->

        <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css">

        <!-- responsive -->

        <link href="css/responsive.css" rel="stylesheet" type="text/css">

        <!-- font-awesome -->

        <link href="css/font-awesome.min.css" rel="stylesheet" type="text/css">

        <!-- font-awesome -->

        <link href="css/effects/set2.css" rel="stylesheet" type="text/css">

        <link href="css/effects/normalize.css" rel="stylesheet" type="text/css">

	</head>


    <body id="body" >

    <div style="height: 100%; width: 100%;">
    	<!-- header -->
        <div style="height: 10vh; position: fixed; z-index: 200; top: 0; width: 100%; background: whitesmoke;">

                <header role="header" >

                    <div class="container" >

                        <!-- logo -->
                        
                            <h1>
                                <a href="index.html" title="avana LLC"><img src="images/logo.png" title="Shree Balaji Spareparts" alt="Shree Balaji Spareparts"/></a>
                            </h1>

                            <span style="font-size: 18px; font-weight: 600; color: darkslategray;">
                                SHREE BALAJI SPAREPARTS KOTKAPURA
                            </span>


                        <!-- logo -->
                                
                        <nav role="header-nav" class="navy">

                            <ul>

                                <li class="nav-active"><a href="index.html" title="Home">Home</a></li>

                                <li><a href="compressor.html" title="Compressors">Compressors</a></li>

                                <li><a href="cooling-coil.html" title="Cooling Coil">Cooling Coil</a></li>

                                <li><a href="condenser.html" title="Condenser">Condenser</a></li>
                                
                                <li><a href="blower-motor.html" title="Blower Motor">Blower Motor</a></li>
                                
                                <li><a href="control-valve.html" title="Control Valve">Control Valve</a></li>

                                <li><a href="expansion-valve.html" title="Expansion Valve">Expansion Valve</a></li>
                                
                                <li><a href="heater.html" title="Heater">Heater</a></li>

                                <li><a href="cabin-filter.html" title="Cabin Filter">Cabin Filter</a></li>

                                <li><a href="fan-motor.html" title="Compressors">Fan Motor</a></li>

                                <li><a href="compressor-parts.html" title="Compressor Parts">Compressor Parts</a></li>

                                <li><a href="sensor.html" title="Switch/ Sensor">Switch/ Sensor</a></li>

                                <li><a href="misc.html" title="Misc">Misc</a></li>

                                <li><a href="contact.html" title="Contact">Contact</a></li>

                            </ul>

                        </nav>

                        <!-- nav -->

                    </div>

                </header>
        </div>

        <div style="height: 10vh;; z-index: 100; top: 0; width: 100%; background: rgb(245, 245, 245);"></div>

        <main role="main-home-wrapper" class="container" style="padding-top: 50px;">

                

            <div class="row">

              <section>
                  <div style="display: flex;justify-content: space-between;padding: 10px;">
                      <div>
                          <a href="https://www.facebook.com/Binder-Car-AC-108892427551787/">
                              <img src="images/facebook-icon.png" style="width: 50px;  height: 50px;" alt="">
                          </a>
                      </div>
                      <div>
                          <a href="https://instagram.com/bindercarackkp?utm_medium=copy_link">
                              <img src="images/instagram-icon.png" style="width: 50px;  height: 50px;" alt="">
                          </a>
                      </div>
                      <div>
                          <a href="tel:919814723517">
                              <img src="images/service-icon.png" style="width: 50px;  height: 50px;" alt="">
                          </a>
                      </div>
                  </div>
              </section>

              <div>
                <p id="message">Loading...</p>
              </div>

            </div>
        </main>

        <!-- footer -->

              <footer role="footer">

                <!-- logo -->

                    <h1>

                        <a href="index.html" title="Shree Balaji Spareparts"><img src="images/logo.png" title="Shree Balaji Spareparts" alt="Shree Balaji Spareparts"/></a>

                    </h1>

                <!-- logo -->

                <!-- nav -->

                <nav role="footer-nav">
                    
                    <div class="float-container">

                        <div class="float-child" style="text-align: right;">
                    
                            <ul>

                                <!-- <li class="nav-active"><a href="index.html" title="Home">Home</a></li> -->

                                <li><a href="about.html" title="About">About</a></li>

                                <li><a href="compressor.html" title="Compressors">Compressors</a></li>

                                <li><a href="cooling-coil.html" title="Cooling Coil">Cooling Coil</a></li>

                                <li><a href="condenser.html" title="Condenser">Condenser</a></li>
                                
                                <li><a href="blower-motor.html" title="Blower Motor">Blower Motor</a></li>
                                
                                <li><a href="control-valve.html" title="Control Valve">Control Valve</a></li>
                                
                                <li><a href="expansion-valve.html" title="Expansion Valve">Expansion Valve</a></li>

                            </ul>

                        </div>

                        <div class="float-child">

                            <ul>
                                
                                <li><a href="heater.html" title="Heater">Heater</a></li>

                                <li><a href="cabin-filter.html" title="Cabin Filter">Cabin Filter</a></li>

                                <li><a href="fan-motor.html" title="Compressors">Fan Motor</a></li>

                                <li><a href="compressor-parts.html" title="Compressor Parts">Compressor Parts</a></li>

                                <li><a href="sensor.html" title="Switch/ Sensor">Switch/ Sensor</a></li>

                                <li><a href="misc.html" title="Misc">Misc</a></li>

                                <li><a href="contact.html" title="Contact">Contact</a></li>

                            </ul>  

                        </div>
                
                    </div>
                
                </nav>

                <!-- nav -->

                <ul role="social-icons">

                    <li><a href="#"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>

                    <li><a href="#"><i class="fa fa-facebook" aria-hidden="true"></i></a></li>

                    <li><a href="#"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li>

                    <li><a href="#"><i class="fa fa-flickr" aria-hidden="true"></i></a></li>

                </ul>

                <ul>
                    <p class="copy-right"><a href="conditions-of-use.html">Conditions of use</a></p>
                    <p class="copy-right"><a href="privacy_policy.html">Privacy Notice</a></p>
                    <p class="copy-right"><a href="cancellation-refund-policy.html">Cancellation/Refund Policy</a></p>
                </ul>
            
                <p class="copy-right">&copy; 2023 Shree Balaji Spareparts.. All rights Reserved</p>

            </footer>
        </div>
        <div style="height: 8vh; position: fixed; bottom: 0;padding: 5px; width: 100%;">
            <div class="container full-size" style="display: flex;">
                <div class="call-box">
                    <a href="tel:+916239444069" title="call"><img src="images/call-logo.jpeg" style="height: 50px; width: 50px;" title="call" alt="call"/></a>
                </div>
                <div class="whatsapp-box">
                    <a href="https://wa.me/916239444069" title="whatsapp"><img src="images/whatsapp-logo.svg" style="height: 50px; width: 50px;color: green;" title="whatsapp" alt="whatsapp"/></a>
                </div>
            </div>
        </div>
      </div>

    <!-- footer -->

    <script>
      function getOrder() {
        const order_id = new URLSearchParams(window.location.search).get('order_id');
        console.log(order_id);
        const getOrderURL = `http://localhost:5000/get_cashfree_order?order_id=${order_id}`;
        fetch(getOrderURL)
        .then(response => response.json())
        .then(data => {
          const payment_status = data[0].payment_status;
          if (payment_status === 'SUCCESS') {
            const p = document.getElementById('message');
            p.textContent = "Order Success";

            //call shiprocket create order api here
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            // let user = JSON.parse(sessionStorage.getItem('user')) || [];
            // console.log(firstName);
            var i = 0;
            cart.forEach(item => {
                const product_id = item.id;
                let length, breadth, height, weight, sku;
                //get product details here
                
                fetch(`http://localhost:5000/get_product_details?product_id=${product_id}`)
                .then(response => response.json())
                .then(results => {
                    results.forEach(entry => {
                        const { cat_id, product_id, p_name, p_length, p_breadth, p_height, p_weight, p_price, p_count, p_location, SKU } = entry;
                        length = p_length;
                        breadth = p_breadth;
                        height = p_height;
                        weight = p_weight;
                        price = p_price;
                        sku = SKU;
                        const order_item = {
                        "sku" : sku,
                        "name" : item.name,
                        "units" : item.quantity,
                        "selling_price" : item.price                
                        }
                        console.log(order_item);
                        let user = JSON.parse(sessionStorage.getItem('user')) || [];
                        let firstName = user[0].firstName;
                        let lastName = user[0].lastName;
                        let country = user[0].country;
                        let adress1 = user[0].adress1;
                        let address2 = user[0].address2;
                        let phone = user[0].phone;
                        let city = user[0].city;
                        let State = user[0].State;
                        let zipCode = user[0].zipCode;
                        let email = user[0].email;
                        console.log("user = " ,firstName);
                        console.log("order_id : ", order_id)
                        // const endpointURL = `http://localhost:5000/create_order?orderId=${order_id}&order_date= "2023-08-08 11:11"&pickup_location=Shreebalajispareparts&channel_id&comment&billing_customer_name=${firstName}&billing_last_name=${lastName}&billing_address=${adress1}&billing_address_2=${address2}&billing_city=${city}&billing_pincode=${zipCode}&billing_state=${State}&billing_country=${country}&billing_email=${email}&billing_phone=${phone}&shipping_is_billing="true"&order_items=${order_item}&payment_method="Prepaid"&shipping_charges=0&giftwrap_charges=0&transaction_charges=0&total_discount=0&sub_total=${p_price}&length=${p_length}&breadth=${p_breadth}&height=${p_height}&weight=${p_weight}`
                        // console.log(endpointURL);
                        const orderData = {
                            order_id: order_id + i,
                            order_date: "2023-08-08 11:11",
                            pickup_location: "Shreebalajispareparts",
                            channel_id: null,
                            comment: null,
                            billing_customer_name: firstName,
                            billing_last_name: lastName,
                            billing_address: adress1,
                            billing_address_2: address2,
                            billing_city: city,
                            billing_pincode: zipCode,
                            billing_state: State,
                            billing_country: country,
                            billing_email: email,
                            billing_phone: phone,
                            shipping_is_billing: true,
                            order_items: [order_item],
                            payment_method: "Prepaid",
                            shipping_charges: 0,
                            giftwrap_charges: 0,
                            transaction_charges: 0,
                            total_discount: 0,
                            sub_total: p_price,
                            length: p_length,
                            breadth: p_breadth,
                            height: p_height,
                            weight: p_weight
                        };
                        console.log(orderData);
                        const endpointURL = 'http://localhost:5000/create_order';
                        
                        fetch(endpointURL, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({data : orderData}),
                        })
                        //fetch(endpointURL)
                        .then(response => response.json())
                        .then(data => {
                        // Handle the Shiprocket API response
                        console.log("shiprocket response");
                        console.log(data);
                        })
                        .catch(error => {
                        console.log("Api call error: " ,error);
                        });
                        console.log("i :",i);
                        i++;
                    });
                })
            }); 
            
    

            console.log('success');
          } else if (payment_status === 'FAILED') {
            const p = document.getElementById('message');
            p.textContent = "Order Failed";
            console.log('failed');
          }
        })
        .catch(error => {
        console.error(error);
        // Handle the error
        });
      }
      getOrder();
    </script>
  </body>
</html>